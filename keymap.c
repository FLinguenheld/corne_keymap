/*
QMK keymap for the crkbd keyboard 3x6
Flo 2022

https://github.com/foostan/crkbd
https://docs.qmk.fm/#/
*/

#include QMK_KEYBOARD_H
#include <stdio.h>
#include <keymap_bepo.h>



// https://github.com/qmk/qmk_firmware/blob/master/quantum/keymap_extras/keymap_bepo.h
        // SEND_STRING("aurnisetaurie");
        // send_unicode_string("(ノಠ痊ಠ)ノ彡┻━┻");


// ------------------------------------------------------------------------------------------------------------------------------------------------------
// Layers -----------------------------------------------------------------------------------------------------------------------------------------------

enum layers { 
    _BASE, 
    _LOWER, 
    _RAISE, 
    _ARROWS,
    _FN,

    // US --
    _US_BASE,
    _US_LOWER,
    _US_RAISE,
    _US_ARROWS,
    _US_FN,
};

// ------------------------------------------------------------------------------------------------------------------------------------------------------
// Tap dance definitions --------------------------------------------------------------------------------------------------------------------------------

#include "features/tap_dance.c" // Here to use layers

qk_tap_dance_action_t tap_dance_actions[] = {
    [TD_BSPC_DEL] = ACTION_TAP_DANCE_TAP_HOLD(KC_BSPC, KC_DEL), // Backspace - Del
    [TD_TREMA_ALT] = ACTION_TAP_DANCE_TAP_HOLD(BP_DIAE, KC_LEFT_ALT), // Trema - Alt
    [TD_EXCLA_QUEST] = ACTION_TAP_DANCE_TAP_HOLD(BP_EXLM, BP_QUES), // ! - ?

    [TD_CURRENCY] = ACTION_TAP_DANCE_TAP_HOLD(BP_DLR, BP_EURO), // $ - €
    [TD_PERCENT] = ACTION_TAP_DANCE_TAP_HOLD(BP_PERC, BP_PERM), // % - BUG

    // Specific tap dances to replace LT(layer, kc)
    [TDS_ARROWS_COLON] = ACTION_TAP_DANCE_FN_ADVANCED(NULL, lt_arrows_colon_finished, lt_arrows_colon_reset),
    [TDS_ARROWS_SCOLON] = ACTION_TAP_DANCE_FN_ADVANCED(NULL, lt_arrows_semicolon_finished, lt_arrows_semicolon_reset),

    // US --
    [US_TD_EXCLA_QUEST] = ACTION_TAP_DANCE_TAP_HOLD(S(KC_1), S(KC_SLASH)), // ! - ?

    [US_TDS_ARROWS_COLON] = ACTION_TAP_DANCE_FN_ADVANCED(NULL, us_lt_arrows_colon_finished, us_lt_arrows_colon_reset),
    [US_TDS_ARROWS_SCOLON] = ACTION_TAP_DANCE_FN_ADVANCED(NULL, us_lt_arrows_semicolon_finished, us_lt_arrows_semicolon_reset),
};


// ------------------------------------------------------------------------------------------------------------------------------------------------------
// Combos -----------------------------------------------------------------------------------------------------------------------------------------------

const uint16_t PROGMEM switch_bepo_usa[] = {KC_TAB, TD(TD_BSPC_DEL), COMBO_END};

const uint16_t PROGMEM combo_fn[] = {TD(TDS_ARROWS_SCOLON), TD(TDS_ARROWS_COLON), COMBO_END};
const uint16_t PROGMEM us_combo_fn[] = {TD(US_TDS_ARROWS_SCOLON), TD(US_TDS_ARROWS_COLON), COMBO_END};

const uint16_t PROGMEM combo_e_dans_l_a[] = {BP_EACU, BP_A, COMBO_END};
const uint16_t PROGMEM combo_e_dans_l_o[] = {BP_EACU, BP_O, COMBO_END};

const uint16_t PROGMEM combo_e_accent[] = {BP_EACU, BP_E, COMBO_END};
const uint16_t PROGMEM combo_a_accent[] = {BP_E, BP_A, COMBO_END};
const uint16_t PROGMEM combo_u_accent[] = {BP_E, BP_U, COMBO_END};
const uint16_t PROGMEM combo_c_cedille[] = {BP_E, BP_C, COMBO_END};


combo_t key_combos[COMBO_COUNT] = {

    COMBO(switch_bepo_usa, TG(_US_BASE)),

    COMBO(combo_fn, MO(_FN)),
    COMBO(us_combo_fn, MO(_US_FN)),

    COMBO(combo_e_dans_l_a, BP_AE),
    COMBO(combo_e_dans_l_o, BP_OE),

    COMBO(combo_e_accent, BP_EGRV),
    COMBO(combo_a_accent, BP_AGRV),
    COMBO(combo_u_accent, BP_UGRV),
    COMBO(combo_c_cedille, BP_CCED)

};


// ------------------------------------------------------------------------------------------------------------------------------------------------------
// Layouts ----------------------------------------------------------------------------------------------------------------------------------------------

  /* [1] = LAYOUT_split_3x6_3(

  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,               XXXXXXX         ,    XXXXXXX     ,    XXXXXXX     ,    XXXXXXX     ,    XXXXXXX     ,       _______         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,               XXXXXXX         ,    XXXXXXX     ,    XXXXXXX     ,    XXXXXXX     ,    XXXXXXX     ,       _______         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,               XXXXXXX         ,    XXXXXXX     ,    XXXXXXX     ,    XXXXXXX     ,    XXXXXXX     ,       _______         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
                                                                  XXXXXXX     ,       XXXXXXX     ,         XXXXXXX       ,          XXXXXXX          ,     XXXXXXX       ,      XXXXXXX
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
  ), */



const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
  [_BASE] = LAYOUT_split_3x6_3(

  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
       KC_TAB               ,     BP_Z       ,    BP_EACU     ,     BP_P       ,     BP_O       ,        BP_J           ,                 BP_K          ,      BP_V      ,      BP_D      ,      BP_L      ,      BP_M      ,     TD(TD_BSPC_DEL)   ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
      GUI_T(KC_ESC)         ,     BP_A       ,     BP_U       ,     BP_I       ,     BP_E       ,   TD(TD_EXCLA_QUEST)  ,                 BP_C          ,      BP_T      ,      BP_S      ,      BP_R      ,      BP_N      ,     RCS_T(BP_ELLP)    ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
      TD(TD_TREMA_ALT)      ,     BP_B       ,     BP_Y       ,     BP_X       ,     BP_W       ,       BP_LABK         ,                BP_RABK        ,      BP_Q      ,      BP_G      ,      BP_H      ,      BP_F      ,     SFT_T(BP_DCIR)    ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
  //                                                |----------------------+----------------------+-----------------------|   |-----------------------+----------------------+----------------------|
                                                        TD(TDS_ARROWS_SCOLON) ,  LT(_LOWER, BP_COMM) ,    LCTL_T(KC_SPC)     ,        KC_ENT             ,  LT(_RAISE, BP_DOT)  ,  TD(TDS_ARROWS_COLON)
  //                                                |----------------------+----------------------+-----------------------|   |-----------------------+----------------------+----------------------|
  ),

  [_LOWER] = LAYOUT_split_3x6_3(

  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            BP_UNDS         ,     XXXXXXX    ,     BP_GRV     ,     BP_QUOT    ,    BP_DQUO     ,        XXXXXXX        ,               XXXXXXX         ,    BP_HASH     ,TD(TD_CURRENCY) ,      BP_AT     ,     XXXXXXX    ,        _______        ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,    BP_LCBR     ,     BP_LBRC    ,    BP_LPRN     ,        BP_SLSH        ,               BP_BSLS         ,    BP_AMPR     ,     BP_PIPE    ,     BP_TILD    ,     BP_ASTR    ,        XXXXXXX        ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,    BP_RCBR     ,     BP_RBRC    ,    BP_RPRN     ,        XXXXXXX        ,               XXXXXXX         ,    XXXXXXX     ,     XXXXXXX    ,     XXXXXXX    ,     BP_CIRC    ,        _______        ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
                                                                 XXXXXXX      ,      XXXXXXX      ,        XXXXXXX        ,           XXXXXXX         ,     XXXXXXX       ,     XXXXXXX
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
  ),

  [_RAISE] = LAYOUT_split_3x6_3(

  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,               XXXXXXX         ,      BP_7      ,      BP_8      ,      BP_9      ,     BP_PLUS    ,       BP_MINS         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,                BP_EQL         ,      BP_4      ,      BP_5      ,      BP_6      ,     BP_ASTR    ,       BP_SLSH         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,                BP_DOT         ,      BP_1      ,      BP_2      ,      BP_3      ,     BP_CIRC    ,    TD(TD_PERCENT)     ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
                                                                  XXXXXXX     ,       XXXXXXX     ,         XXXXXXX       ,          XXXXXXX          ,     XXXXXXX       ,      BP_0
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
  ),

  [_ARROWS] = LAYOUT_split_3x6_3(

  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,  KC_MS_WH_LEFT ,   KC_MS_WH_UP  ,  KC_MS_WH_DOWN , KC_MS_WH_RIGHT ,        XXXXXXX        ,               XXXXXXX         ,    KC_HOME     ,  KC_PAGE_DOWN  ,   KC_PAGE_UP   ,     KC_END     ,       _______         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,   KC_MS_LEFT   ,    KC_MS_UP    ,   KC_MS_DOWN   ,   KC_MS_RIGHT  ,        XXXXXXX        ,               XXXXXXX         ,    KC_LEFT     ,    KC_DOWN     ,     KC_UP      ,    KC_RIGHT    ,       _______         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,   KC_MS_BTN1   ,     XXXXXXX    ,   KC_MS_BTN3   ,   KC_MS_BTN2   ,        XXXXXXX        ,               XXXXXXX         ,    XXXXXXX     ,    C(BP_D)     ,    C(BP_U)     ,    XXXXXXX     ,       _______         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
                                                                  XXXXXXX     ,       XXXXXXX     ,         XXXXXXX       ,          XXXXXXX          ,     XXXXXXX       ,      XXXXXXX
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
  ),

  [_FN] = LAYOUT_split_3x6_3(

  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,               XXXXXXX         ,      KC_F7     ,      KC_F8     ,      KC_F9     ,     KC_F10     ,    KC_PRINT_SCREEN    ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,               XXXXXXX         ,      KC_F4     ,      KC_F5     ,      KC_F6     ,     KC_F11     ,   S(KC_PRINT_SCREEN)  ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,               XXXXXXX         ,      KC_F1     ,      KC_F2     ,      KC_F3     ,     KC_F12     ,       _______         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
                                                                  XXXXXXX     ,       XXXXXXX     ,         XXXXXXX       ,          XXXXXXX          ,     XXXXXXX       ,      XXXXXXX
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
  ),


// ------------------------------------------------------------------------------------------------------------------------------------------------------
// USA --------------------------------------------------------------------------------------------------------------------------------------------------

  [_US_BASE] = LAYOUT_split_3x6_3(

  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
       KC_TAB               ,     KC_Z       ,    XXXXXXX     ,     KC_P       ,     KC_O       ,        KC_J           ,                 KC_K          ,      KC_V      ,      KC_D      ,      KC_L      ,      KC_M      ,     TD(TD_BSPC_DEL)   ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
      LGUI_T(KC_ESC)        ,     KC_A       ,     KC_U       ,     KC_I       ,     KC_E       ,  TD(US_TD_EXCLA_QUEST),                 KC_C          ,      KC_T      ,      KC_S      ,      KC_R      ,      KC_N      ,      RCS_T(KC_DOT)    ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
       KC_LALT              ,     KC_B       ,     KC_Y       ,     KC_X       ,     KC_W       ,     S(KC_COMMA)       ,               S(KC_DOT)       ,      KC_Q      ,      KC_G      ,      KC_H      ,      KC_F      ,      SFT_T(S(KC_6))   ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
  //                                            |------------------------+------------------------+-----------------------|   |-----------------------+------------------------+------------------------|
                                               TD(US_TDS_ARROWS_SCOLON)  , LT(_US_LOWER, KC_COMMA),    LCTL_T(KC_SPC)     ,        KC_ENT             , LT(_US_RAISE, KC_DOT)  , TD(US_TDS_ARROWS_COLON)
  //                                            |------------------------+------------------------+-----------------------|   |-----------------------+------------------------+------------------------|
  ),

  [_US_LOWER] = LAYOUT_split_3x6_3(

  //|-----------------------+----------------+-----------------+-----------------+------------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            S(KC_MINUS)     ,     XXXXXXX    ,    KC_GRAVE     ,    KC_QUOTE     ,   S(KC_QUOTE)    ,        XXXXXXX        ,               XXXXXXX         ,    S(KC_3)     ,     S(KC_4)    ,     S(KC_2)    ,     XXXXXXX    ,        _______        ,
  //|-----------------------+----------------+-----------------+-----------------+------------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,   S(KC_LBRC)    ,    KC_LBRC      ,     S(KC_9)      ,       KC_SLASH        ,             KC_BACKSLASH      ,    S(KC_7)     , S(KC_BACKSLASH),   S(KC_GRAVE)  ,     S(KC_8)    ,        _______        ,
  //|-----------------------+----------------+-----------------+-----------------+------------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,   S(KC_RBRC)    ,    KC_RBRC      ,     S(KC_0)      ,        XXXXXXX        ,               XXXXXXX         ,    XXXXXXX     ,     XXXXXXX    ,     XXXXXXX    ,     S(KC_6)    ,        _______        ,
  //|-----------------------+----------------+-----------------+-----------------+------------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
  //                                                      |---------------------+---------------------+-----------------------|   |-----------------------+-------------------+-------------------|
                                                                  XXXXXXX       ,      XXXXXXX        ,        XXXXXXX        ,           XXXXXXX         ,     XXXXXXX       ,     XXXXXXX
  //                                                      |---------------------+---------------------+-----------------------|   |-----------------------+-------------------+-------------------|
  ),

  [_US_RAISE] = LAYOUT_split_3x6_3(

  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,               XXXXXXX         ,      KC_7      ,      KC_8      ,      KC_9      ,    S(KC_EQL)   ,       KC_MINUS        ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,                KC_EQL         ,      KC_4      ,      KC_5      ,      KC_6      ,     S(KC_8)    ,       KC_SLASH        ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,                KC_DOT         ,      KC_1      ,      KC_2      ,      KC_3      ,     S(KC_6)    ,        S(KC_5)        ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
                                                                  XXXXXXX     ,       XXXXXXX     ,         XXXXXXX       ,          XXXXXXX          ,     XXXXXXX       ,      KC_0
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
  ),

  [_US_ARROWS] = LAYOUT_split_3x6_3(

  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,  KC_MS_WH_LEFT ,   KC_MS_WH_UP  ,  KC_MS_WH_DOWN , KC_MS_WH_RIGHT ,        XXXXXXX        ,               XXXXXXX         ,    KC_HOME     ,  KC_PAGE_DOWN  ,   KC_PAGE_UP   ,     KC_END     ,       _______         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,   KC_MS_LEFT   ,    KC_MS_UP    ,   KC_MS_DOWN   ,   KC_MS_RIGHT  ,        XXXXXXX        ,               XXXXXXX         ,    KC_LEFT     ,    KC_DOWN     ,     KC_UP      ,    KC_RIGHT    ,       _______         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,   KC_MS_BTN1   ,     XXXXXXX    ,   KC_MS_BTN3   ,   KC_MS_BTN2   ,        XXXXXXX        ,               XXXXXXX         ,    XXXXXXX     ,    C(KC_D)     ,    C(KC_U)     ,    XXXXXXX     ,       _______         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
                                                                  XXXXXXX     ,       XXXXXXX     ,         XXXXXXX       ,          XXXXXXX          ,     XXXXXXX       ,      XXXXXXX
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
  ),

  [_US_FN] = LAYOUT_split_3x6_3(

  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,               XXXXXXX         ,      KC_F7     ,      KC_F8     ,      KC_F9     ,     KC_F10     ,    KC_PRINT_SCREEN    ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,               XXXXXXX         ,      KC_F4     ,      KC_F5     ,      KC_F6     ,     KC_F11     ,   S(KC_PRINT_SCREEN)  ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
            _______         ,     XXXXXXX    ,     XXXXXXX    ,     XXXXXXX    ,    XXXXXXX     ,        XXXXXXX        ,               XXXXXXX         ,      KC_F1     ,      KC_F2     ,      KC_F3     ,     KC_F12     ,       _______         ,
  //|-----------------------+----------------+----------------+----------------+----------------+-----------------------|       |-----------------------+----------------+----------------+----------------+----------------+-----------------------|
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
                                                                  XXXXXXX     ,       XXXXXXX     ,         XXXXXXX       ,          XXXXXXX          ,     XXXXXXX       ,      XXXXXXX
  //                                                      |-------------------+-------------------+-----------------------|   |-----------------------+-------------------+-------------------|
  ),
};


// ------------------------------------------------------------------------------------------------------------------------------------------------------
// Auto shift -------------------------------------------------------------------------------------------------------------------------------------------

// Only for letters and on basis layers
// Exceptions like Tab underneath

bool get_auto_shifted_key(uint16_t keycode, keyrecord_t *record) {

    if (IS_LAYER_ON(_BASE)) {

        switch (keycode) {
            case BP_A:
            case BP_B:
            case BP_C:
            case BP_D:
            case BP_E:
            case BP_F:
            case BP_G:
            case BP_H:
            case BP_I:
            case BP_J:
            case BP_K:
            case BP_L:
            case BP_M:
            case BP_N:
            case BP_O:
            case BP_P:
            case BP_Q:
            case BP_R:
            case BP_S:
            case BP_T:
            case BP_U:
            case BP_V:
            case BP_W:
            case BP_X:
            case BP_Y:
            case BP_Z:

            case BP_EACU: // É
            case BP_EGRV: // È
            case BP_ECIR: // Ê

            case BP_CCED: // Ç
            case BP_AGRV: // À
            case BP_UGRV: // Ù

            case BP_OE: // Œ
            case BP_AE: // Æ

                return true;
        }
    }
    else if (IS_LAYER_ON(_US_BASE)) {
        
        switch (keycode) {
            case KC_A:
            case KC_B:
            case KC_C:
            case KC_D:
            case KC_E:
            case KC_F:
            case KC_G:
            case KC_H:
            case KC_I:
            case KC_J:
            case KC_K:
            case KC_L:
            case KC_M:
            case KC_N:
            case KC_O:
            case KC_P:
            case KC_Q:
            case KC_R:
            case KC_S:
            case KC_T:
            case KC_U:
            case KC_V:
            case KC_W:
            case KC_X:
            case KC_Y:
            case KC_Z:

                return true;
        }
    }

    switch (keycode) {
        case KC_TAB:
        case KC_ENT:
            return true;
    }
    
    return get_custom_auto_shifted_key(keycode, record);
}


// ------------------------------------------------------------------------------------------------------------------------------------------------------
// Oled display -----------------------------------------------------------------------------------------------------------------------------------------

// Logos (and fonts) are in the glcdfont_.c files
static void render_logo(void) {
    static const char PROGMEM qmk_logo[] = {
        0x80, 0x80, 0x80, 0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87, 0x88, 0x89, 0x8A, 0x8B, 0x8C, 0x8D, 0x80, 0x80, 0x80, 0x80,
        0xA0, 0xA0, 0xA0, 0xA0, 0xA1, 0xA2, 0xA3, 0xA4, 0xA5, 0xA6, 0xA7, 0xA8, 0xA9, 0xAA, 0xAB, 0xAC, 0xAD, 0xA0, 0xA0, 0xA0, 0xA0,
        0xC0, 0xC0, 0xC0, 0xC0, 0xC1, 0xC2, 0xC3, 0xC4, 0xC5, 0xC6, 0xC7, 0xC8, 0xC9, 0xCA, 0xCB, 0xCC, 0xCD, 0xC0, 0xC0, 0xC0, 0xC0, 0x00
    };

    oled_write_P(qmk_logo, false);
}
static void render_logo_us(void) {
    static const char PROGMEM qmk_logo[] = {
        0x80, 0x80, 0x8D, 0x8E, 0x8F, 0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97, 0x98, 0x99, 0x9A, 0x9B, 0x9C, 0x9D, 0x9E, 0x9F,
        0xA0, 0xA0, 0xAD, 0xAE, 0xAF, 0xB0, 0xB1, 0xB2, 0xB3, 0xB4, 0xB5, 0xB6, 0xB7, 0xB8, 0xB9, 0xBA, 0xBB, 0xBC, 0xBD, 0xBE, 0xBF,
        0xC0, 0xC0, 0xCD, 0xCE, 0xCF, 0xD0, 0xD1, 0xD2, 0xD3, 0xD4, 0xD5, 0xD6, 0xD7, 0xD8, 0xD9, 0xDA, 0xDB, 0xDC, 0xDD, 0xDE, 0xDF, 0x00
    };

    oled_write_P(qmk_logo, false);
}


// Return the logo for the right part
oled_rotation_t oled_init_user(oled_rotation_t rotation) {

#ifdef MASTER_RIGHT
    return OLED_ROTATION_180;
#endif

    return rotation;
}

// Wonderful display !
bool oled_task_user(void) {

        oled_clear();
    // if (is_keyboard_master()) {

        switch (get_highest_layer(layer_state)) {
            // case _US_BASE:
            case _US_LOWER:
            case _US_RAISE:
            case _US_ARROWS:
            case _US_FN:

#ifdef MASTER_LEFT
    oled_write_P(PSTR("\n"), false);
#endif
                oled_write_P(PSTR("    $$$$$ USA $$$$$"), false);

#ifdef MASTER_RIGHT
    oled_write_P(PSTR("\n"), false);
#endif
        }


#ifdef MASTER_LEFT
    oled_write_P(PSTR("\n"), false);
#endif

        switch (get_highest_layer(layer_state)) {
            case _BASE:
                render_logo();
                break;

            case _US_BASE:
                render_logo_us();
                break;

            case _LOWER:
            case _US_LOWER:
                oled_write_P(PSTR("\n      -- LOWER --"), false);
                break;

            case _RAISE:
            case _US_RAISE:
                oled_write_P(PSTR("\n      -- RAISE --"), false);
                break;

            case _ARROWS:
            case _US_ARROWS:
                oled_write_P(PSTR("\n    --- ARROWS ---"), false);
                break;

            case _FN:
            case _US_FN:
                oled_write_P(PSTR("\n     ---- FN ----"), false);
                break;
        }

    // oled_invert(true);
    return false;
}
